import{a as U,q as V,e as a,j as E,k as w,m as $,l as v,u as h,z as k,g as e,r as y,f as d,v as G,x as W,F as b,i as T,w as Y,t as C,h as j,B as I,R as J,o as K,p as N}from"./index-oqzXqftB.js";import{U as L}from"./UserService-q-keLY2x.js";import{a as D,u as Q}from"./TicketStore-nKNHW40S.js";import{u as z}from"./UserStore-b7oFAVpl.js";import{S as X,_ as ee}from"./SideSectionTop-VN73Jf1V.js";import{S as B}from"./SimpleButton--xCyfZby.js";import{_ as te}from"./remove-2QpsD6we.js";import{_ as se}from"./Chevron Down-nkaAdt-3.js";import{S as oe}from"./StatusesService-oFrA8N4P.js";import{T as A}from"./TicketsService-X8iuOJwP.js";import{T as le}from"./TicketsTable-FsraF8TK.js";import{_ as re}from"./Modal-4VB_iAA1.js";import"./ToastStore-dICTQD1A.js";const ne={class:"flex flex-col py-2 gap-4"},ie={class:"flex flex-col px-4 gap-2 xl:gap-4"},ae=e("div",{class:"text-purple text-l xl:text-lg whitespace-nowrap pr-2"}," Assignados a mim ",-1),ce=[ae],de=e("div",{class:"text-purple text-l xl:text-lg whitespace-nowrap pr-2"}," Os meus tickets ",-1),pe=[de],ue={class:"justify-center flex flex-col pt-2"},he=e("div",{class:"text-purple text-l xl:text-lg whitespace-nowrap"}," Pendente ",-1),ge=[he],_e=e("div",{class:"text-purple text-l xl:text-lg whitespace-nowrap"}," Em Progresso ",-1),me=[_e],fe=e("div",{class:"text-purple text-l xl:text-lg whitespace-nowrap"}," Completo ",-1),xe=[fe],ve={__name:"SideFilter",setup(O){const r=D(),o=z();let l=U({selected:null});const n=()=>{r.handleFilterReset(),l.selected="Todos os tickets",f()},u=()=>{r.handleFilterReset(),r.handleFilterChange("technician",o.currentUser.name),l.selected="Assignados a mim",f()},_=()=>{r.handleFilterReset(),r.handleFilterChange("user",o.currentUser.name),l.selected="Os meus tickets",f()},m=t=>{r.handleFilterReset(),r.handleFilterChange("status",t),l.selected=t,f()},f=()=>{r.handleSideFilterChange()};return V(()=>r.filteredTickets,()=>{l.selected=null}),(t,i)=>(a(),E(ee,{class:"hidden"},{default:w(()=>[v(X,null,{default:w(()=>[$("Tickets")]),_:1}),e("div",ne,[e("div",ie,[e("span",{onClick:n,class:k([{"bg-greyDark":h(l).selected==="Todos os tickets"},"hoverGreyDark rounded-t-lg text-pink-600 text-l xl:text-lg justify-center py-3.5 px-2 border-b-purple border-b-opacity-30 border-b border-solid"])}," Todos os tickets ",2),e("div",{onClick:u,class:k([{"bg-greyDark":h(l).selected==="Assignados a mim"},"hoverGreyDark rounded-t-lg justify-center py-3.5 px-2 flex flex-col border-b-purple border-b-opacity-30 border-b border-solid"])},ce,2),e("div",{onClick:_,class:k([{"bg-greyDark":h(l).selected==="Os meus tickets"},"hoverGreyDark rounded-t-lg justify-center py-3.5 px-2 flex flex-col border-b-purple border-b-opacity-30 border-b border-solid"])},pe,2),e("div",ue,[e("span",{onClick:i[0]||(i[0]=s=>m("Pendente")),class:k([{"bg-greyDark":h(l).selected==="Pendente"},"justify-between flex py-3 px-2 hoverGreyDark rounded-lg"])},ge,2),e("span",{onClick:i[1]||(i[1]=s=>m("Em Progresso")),class:k([{"bg-greyDark":h(l).selected==="Em Progresso"},"justify-between flex py-3 px-2 hoverGreyDark rounded-lg"])},me,2),e("span",{onClick:i[2]||(i[2]=s=>m("Completo")),class:k([{"bg-greyDark":h(l).selected==="Completo"},"justify-between flex py-3 px-2 hoverGreyDark rounded-lg"])},xe,2)])])])]),_:1}))}},ke="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M15%2010.5C15%2012.9853%2012.9853%2015%2010.5%2015C8.01472%2015%206%2012.9853%206%2010.5C6%208.01472%208.01472%206%2010.5%206C12.9853%206%2015%208.01472%2015%2010.5ZM14.1793%2015.2399C13.1632%2016.0297%2011.8865%2016.5%2010.5%2016.5C7.18629%2016.5%204.5%2013.8137%204.5%2010.5C4.5%207.18629%207.18629%204.5%2010.5%204.5C13.8137%204.5%2016.5%207.18629%2016.5%2010.5C16.5%2011.8865%2016.0297%2013.1632%2015.2399%2014.1792L20.0304%2018.9697L18.9697%2020.0303L14.1793%2015.2399Z'%20fill='%23080341'/%3e%3c/svg%3e",be={class:"border bg-white flex justify-between w-40 lg:w-60 py-1 lg:py-0 lg:px-2.5 rounded-xl border-solid border-black border-opacity-20"},we=e("img",{loading:"lazy",src:ke,class:"aspect-[1.5] object-contain object-center"},null,-1),ye={__name:"SearchBox",setup(O){const r=D(),o=y(""),l=(n,u)=>{r.handleFilterChange(n,u)};return(n,u)=>(a(),d("span",be,[we,G(e("input",{type:"text",class:"bg-transparent text-gray-900 focus:outline-none focus-visible:outline-none rounded-lg w-full lg:p-2",placeholder:"Procurar... ","onUpdate:modelValue":u[0]||(u[0]=_=>o.value=_),onInput:u[1]||(u[1]=_=>l("searchTerm",o.value))},null,544),[[W,o.value]])]))}},Ce="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20d='M4%2012H20M12%204V20'%20stroke='%23fff'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/g%3e%3c/svg%3e",Te={class:"relative"},$e=e("img",{loading:"lazy",src:Ce,class:"self-center"},null,-1),Oe=e("div",{class:"text-white sm:text-lg"},"Filtros",-1),Se=[$e,Oe],Fe={key:0,class:"absolute left-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5"},Pe={class:"py-1",role:"menu","aria-orientation":"vertical","aria-labelledby":"options-menu"},De=["href","onClick"],Me=["onClick"],Ne={class:"flex gap-1"},je=["onClick"],Ve=e("img",{loading:"lazy",src:se},null,-1),Ge={key:0,class:"absolute left-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 p-2"},Re=["onUpdate:modelValue"],Be=["value"],Ae=["onClick"],Ue=["onClick"],Ee={__name:"FilterDropdown",setup(O){const r=D(),o=U({isOpen:!1,selectedOptions:[],dropdownItems:[{id:"technician",name:"TÃ©cnico"},{id:"category",name:"Categoria"},{id:"priority",name:"Prioridade"},{id:"status",name:"Estado"}]}),l={technician:L.getTechnicians,category:A.getCategories,priority:A.getPriorities,status:oe.getStatuses},n=()=>{o.isOpen=!o.isOpen},u=async t=>{if(!o.selectedOptions.find(i=>i.id===t.id)){const i=l[t.id];if(i){const s=(await i()).data.map(c=>({id:c.id,name:c.name}));o.selectedOptions.push({...t,isOpen:!1,selectedNestedOptions:[],dropdownItems:s})}}o.isOpen=!1},_=t=>{t.selectedNestedOptions.find(i=>i.id===t.selectedNestedOption.id)||t.selectedNestedOptions.push(t.selectedNestedOption),t.selectedNestedOption=null,t.isOpen=!1,r.handleFilterChange(t.id,t.selectedNestedOptions.map(i=>i.name)),r.resetSideFilter(),console.log(t.selectedNestedOptions)},m=(t,i)=>{t.selectedNestedOptions.pop(i),t.selectedNestedOptions.length===0?r.handleFilterChange(t.id,"all"):r.handleFilterChange(t.id,t.selectedNestedOptions.map(s=>s.name))};return V(()=>r.sideFilterChange,()=>{o.selectedOptions.forEach(t=>{t.selectedNestedOptions=[]}),o.selectedOptions=[]}),(t,i)=>(a(),d(b,null,[e("div",Te,[e("button",{onClick:n,class:"justify-center bg-purple flex gap-2.5 px-3 py-[5.5px] rounded-xl hoverBlue"},Se),o.isOpen?(a(),d("div",Fe,[e("div",Pe,[(a(!0),d(b,null,T(o.dropdownItems,s=>(a(),d("a",{key:s.id,href:s.href,onClick:Y(c=>u(s),["prevent"]),class:"block px-4 py-2 text-sm hoverBlue",role:"menuitem"},C(s.name),9,De))),128))])])):j("",!0)]),(a(!0),d(b,null,T(o.selectedOptions,s=>(a(),d("div",{key:s.id,class:"relative bg-purple text-white px-2 py-1 rounded-xl hoverBlue"},[e("button",{onClick:c=>s.isOpen=!s.isOpen},[e("div",Ne,[e("img",{loading:"lazy",src:te,class:"self-center hoverRed rounded-md",onClick:c=>o.selectedOptions=o.selectedOptions.filter(S=>S.id!==s.id)},null,8,je),e("p",null,C(s.name),1),Ve])],8,Me),s.isOpen?(a(),d("div",Ge,[G(e("select",{"onUpdate:modelValue":c=>s.selectedNestedOption=c,class:"cursor-pointer block w-full px-4 py-2 text-sm text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm mb-2"},[(a(!0),d(b,null,T(s.dropdownItems,c=>(a(),d("option",{key:c.id,value:c},C(c.name),9,Be))),128))],8,Re),[[I,s.selectedNestedOption]]),e("button",{class:"w-full text-center py-2 bg-purple text-white hoverBlue",onClick:c=>_(s)},"Done",8,Ae)])):j("",!0),(a(!0),d(b,null,T(s.selectedNestedOptions,c=>(a(),d("div",{onClick:S=>m(s,c),key:c.id,class:"inline-block bg-white rounded-lg px-3 py-1 text-sm font-semibold text-purpleLight ml-1 hoverRed"},C(c.name),9,Ue))),128))]))),128))],64))}},Ie={class:"text-purple flex sm:text-2xl text-xl whitespace-nowrap justify-between p-4 h-[9vh] border-b-purple border-b-opacity-30 border-b border-solid items-start"},Le=e("div",null,"Todos os Tickets",-1),ze={class:"flex gap-4"},Ze={class:"flex flex-row justify-end lg:justify-between p-3 border-b-black border-b-opacity-30 border-b border-solid items-start"},qe={class:"hidden lg:flex flex-col sm:flex-row items-center gap-2"},He={__name:"TopMenu",emits:["exportToPdf"],setup(O,{emit:r}){const o=r;return(l,n)=>(a(),d(b,null,[e("span",Ie,[Le,e("div",ze,[v(B,{class:"hidden lg:block",onClick:n[0]||(n[0]=u=>o("exportToPdf"))},{default:w(()=>[$("Exportar Para PDF")]),_:1}),v(h(J),{to:"/tickets/create"},{default:w(()=>[v(B,null,{default:w(()=>[$(" + Criar Ticket ")]),_:1})]),_:1})])]),e("div",Ze,[e("div",qe,[v(Ee)]),v(ye)])],64))}},We={class:"flex w-full overflow-auto"},Ye={key:0},Je={key:1,class:"flex w-full"},Ke={class:"flex flex-col w-full"},Qe={class:"flex justify-between px-5 py-2 border-b-black border-b-opacity-30 border-b border-solid"},Xe={class:"text-black text-opacity-60 sm:text-xl"},et={class:"flex gap-1 sm:gap-2.5"},tt=e("option",{value:"5"},"5 por pagina",-1),st=e("option",{value:"10"},"10 por pagina",-1),ot=e("option",{value:"20"},"20 por pagina",-1),lt=e("option",{value:"All"},"All",-1),rt=[tt,st,ot,lt],nt=["onClick"],kt={__name:"ShowTicketPage",setup(O){const r=y([]),o=y([]),l=y(1),n=y("All"),u=y(""),_=z(),m=Q(),f=D();K(async()=>{await t(),await i()});const t=async()=>{try{r.value=await f.getTickets()}catch(p){console.error("Error fetching tickets:",p)}},i=async()=>{try{const p=await L.getTechnicians();p.success?o.value=p.data:console.error("Invalid response structure:",p)}catch(p){console.error("Error fetching technicians:",p)}},s=()=>{m.handleCancelModal()},c=()=>{m.handleConfirmModal()},S=N(()=>{let p=[];const x=q.value,g=l.value;let F=Math.max(g-1,1),P=F+2;P>x&&(P=x,F=Math.max(1,P-2));for(let M=F;M<=P;M++)p.push(M);return p}),Z=N(()=>{const p=f.filteredTickets,x=(l.value-1)*(n.value==="All"?p.length:n.value),g=x+(n.value==="All"?p.length:n.value);return p.slice(x,g)}),q=N(()=>n.value==="All"?1:Math.ceil(f.filteredTickets.length/n.value)),R=p=>{l.value=p,n.value!=="All"&&(n.value=Number(n.value))};V(u,()=>{l.value=1});const H=()=>{m.convertTicketsToPDF()};return(p,x)=>(a(),d("div",We,[h(_).isLoading?(a(),d("div",Ye)):(a(),d("div",Je,[h(_).userRole==="technician"||h(_).userRole==="admin"?(a(),E(ve,{key:0})):j("",!0),e("span",Ke,[v(He,{onExportToPdf:H}),e("span",Qe,[e("div",Xe,C(h(f).filteredTickets.length)+" Tickets ",1),e("div",et,[G(e("select",{"onUpdate:modelValue":x[0]||(x[0]=g=>n.value=g),onChange:x[1]||(x[1]=g=>R(1)),class:"cursor-pointer"},rt,544),[[I,n.value]]),(a(!0),d(b,null,T(S.value,g=>(a(),d("span",{class:k(["text-black sm:text-xl justify-center px-1.5 py-0.5 rounded-md self-start cursor-pointer",{"bg-purple text-white hoverBlue":g===l.value,"aspect-[0.8148148148148148]":!0}]),key:g,onClick:F=>R(g)},C(g),11,nt))),128))])]),v(le,{id:"ticketsTable",tickets:Z.value,technicians:o.value},null,8,["tickets","technicians"]),v(re,{show:h(m).showModal,onCancel:s,onConfirm:c},{title:w(()=>[$(" Atribuir tÃ©cnico ")]),content:w(()=>[$(" EstÃ¡ prestes a atribuir um tÃ©cnico a este ticket. Deseja continuar? ")]),_:1},8,["show"])])]))]))}};export{kt as default};
