import{u as Z,a as H,_ as O}from"./SimpleSelect-GCDcFehr.js";import{T as E,_ as q,S as z}from"./SideSectionTop-NF86ofct.js";import{U as Y}from"./UserService-Md1eL1dT.js";import{e as a,f as c,g as e,F as G,i as R,h as V,m as y,t as g,u as f,A as $,r as w,o as A,p as W,z as J,q as K,k as Q,l as p,G as X,_ as ee,H as te,I as se,a as oe,x as ae,w as x,y as ce,j as B,B as le,C as re}from"./index-pqQ-StaB.js";import{S as j}from"./SimpleButton-yUcAyILW.js";import{_ as ie}from"./Modal-Yuxk1HSr.js";import{_ as ne,a as de}from"./TiptapEditor-frd9eoN6.js";import{u as I}from"./UserStore-RP0sjdM7.js";const me="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20fill='%23ffffff'%20height='20px'%20width='20px'%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%20512%20512'%20enable-background='new%200%200%20512%20512'%20xml:space='preserve'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20d='M389.6,289.4c0,73.8-59.8,133.6-133.6,133.6c-73.7,0-133.6-59.8-133.6-133.6c0-73.8,59.8-133.6,133.6-133.6v66.8%20l113.9-111.3L256,0v66.8c-122.9,0-222.6,99.7-222.6,222.6C33.4,412.3,133.1,512,256,512c122.9,0,222.6-99.7,222.6-222.6H389.6z'/%3e%3c/g%3e%3c/svg%3e",ue="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='24'%20height='24'%20viewBox='0%200%20512%20512'%20xmlns='http://www.w3.org/2000/svg'%20fill='%23000000'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20fill='var(--ci-primary-color,%20%23000000)'%20d='M334.627,16H48V496H472V153.373ZM440,166.627V168H320V48h1.373ZM80,464V48H288V200H440V464Z'%20class='ci-primary'/%3e%3crect%20width='224'%20height='32'%20x='136'%20y='296'%20fill='var(--ci-primary-color,%20%23000000)'%20class='ci-primary'/%3e%3crect%20width='224'%20height='32'%20x='136'%20y='376'%20fill='var(--ci-primary-color,%20%23000000)'%20class='ci-primary'/%3e%3c/g%3e%3c/svg%3e",pe={class:"flex gap-4"},he={class:"flex flex-col text-lg gap-4 text-wrap"},ge=e("div",{class:"flex gap-1"},[e("img",{src:ue}),e("p",{class:"text-2xl"}," Ticket Description ")],-1),fe={class:"prose max-w-none"},_e=["innerHTML"],we={key:0,class:"mt-4"},ve=["src","alt"],xe={__name:"DescriptionView",props:{myTicket:Object},setup(s){return(_,b)=>(a(),c("div",pe,[e("div",he,[ge,e("div",fe,[e("p",{class:"text-black text-opacity-70",innerHTML:s.myTicket.description},null,8,_e),s.myTicket.attachments&&s.myTicket.attachments.length?(a(),c("div",we,[(a(!0),c(G,null,R(s.myTicket.attachments,(t,n)=>(a(),c("span",{key:n,class:"ml-2 inline-block"},[e("img",{src:t.FilePath,class:"max-w-lg rounded-lg",alt:"Attachment "+(n+1)},null,8,ve)]))),128))])):V("",!0)])])]))}},ye={class:"pb-5 flex gap-4"},ke=["src"],be={class:"text-lg flex flex-col gap-2 text-wrap"},Ce={class:"text-xl"},Ve={class:"text-sm text-gray-600"},Se={class:"text-black bg-stone-200 rounded-lg p-3 text-opacity-65"},Te=["innerHTML"],$e={key:0,class:"mt-4"},Ge=["src","alt"],Re={__name:"CommentsView",props:{comment:Object},setup(s){const _=s,b=new Date(_.comment.created_at);return(t,n)=>(a(),c("div",ye,[e("img",{loading:"lazy",src:s.comment.user.user_info.profile_picture_path,class:"aspect-square object-cover object-center w-10 h-10 overflow-hidden shrink-0 rounded-[50%]"},null,8,ke),e("div",be,[e("p",Ce,[y(g(s.comment.user.name)+" - ",1),e("span",Ve,g(f(b).toLocaleString()),1)]),e("p",Se,[e("div",{class:"prose max-w-none",innerHTML:s.comment.comment_body},null,8,Te),s.comment.attachments&&s.comment.attachments.length?(a(),c("div",$e,[(a(!0),c(G,null,R(s.comment.attachments,(r,u)=>(a(),c("span",{key:u,class:"ml-2 inline-block"},[e("img",{src:r.FilePath,class:"max-w-xs rounded-lg",alt:"Attachment "+(u+1)},null,8,Ge)]))),128))])):V("",!0)])])]))}},De="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20fill='%23ffffff'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20xmlns='http://www.w3.org/2000/svg'%20stroke='none'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20d='M3,4V16a1,1,0,0,0,1,1H9l3,4,3-4h5a1,1,0,0,0,1-1V4a1,1,0,0,0-1-1H4A1,1,0,0,0,3,4ZM8,7h8a1,1,0,0,1,0,2H8A1,1,0,0,1,8,7Zm0,5h4a1,1,0,0,1,0,2H8a1,1,0,0,1,0-2Z'/%3e%3c/g%3e%3c/svg%3e",Me="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='24'%20height='24'%20viewBox='0%200%20512%20512'%20xmlns='http://www.w3.org/2000/svg'%20fill='%23fff'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20fill='var(--ci-primary-color,%20%23fff)'%20d='M334.627,16H48V496H472V153.373ZM440,166.627V168H320V48h1.373ZM80,464V48H288V200H440V464Z'%20class='ci-primary'/%3e%3crect%20width='224'%20height='32'%20x='136'%20y='296'%20fill='var(--ci-primary-color,%20%23fff)'%20class='ci-primary'/%3e%3crect%20width='224'%20height='32'%20x='136'%20y='376'%20fill='var(--ci-primary-color,%20%23fff)'%20class='ci-primary'/%3e%3c/g%3e%3c/svg%3e",U={getComments:async s=>$.makeRequest("get",`tickets/${s}/comments`),createComment:async s=>$.makeRequest("post","comments",s,"multipart/form-data"),deleteComment:async s=>$.makeRequest("delete",`comments/${s}`),getCommentTypes:async()=>$.makeRequest("get","commentTypes")},je={class:"text-purple flex w-full flex-col p-3 gap-3 sm:text-2xl text-xl items-start"},Ue={class:"flex justify-between text-xl gap-2 w-full"},He={class:"flex"},Ee=e("img",{src:de},null,-1),Be=["disabled"],Ae=["value"],Ie={class:"w-full border border-solid border-black border-opacity-20 rounded-lg bg-grey"},Fe={class:"px-4 py-2 bg-grey rounded-t-lg"},Le={__name:"CreateCommentForm",props:{ticket:Object},emits:["refreshComments"],setup(s,{emit:_}){const b=_,t=I(),n=w(1),r=w(null),u=w(""),v=w([]),i=s,D=l=>{v.value=l};A(async()=>{await S(),await t.fetchAuthedUser()});const S=async()=>{try{r.value=(await U.getCommentTypes()).data}catch(l){console.error("Error fetching comment types:",l)}},M=l=>{n.value=l.target.value},T=async()=>{const l=new FormData;l.append("comment_body",u.value),l.append("comment_type",n.value),l.append("ticket_id",i.ticket.id),v.value.forEach((d,m)=>{l.append(`files[${m}]`,d.file)});try{const d=await U.createComment(l)}catch(d){console.error("Error posting comment:",d)}await X(async()=>{b("refreshComments"),u.value="",v.value=[]})};return(l,d)=>(a(),c("div",je,[e("div",Ue,[e("div",He,[Ee,W(e("select",{style:K({appearance:["admin","technician"].includes(f(t).userRole)?"auto":"none"}),class:"flex px-2","onUpdate:modelValue":d[0]||(d[0]=m=>n.value=m),onChange:M,disabled:!["admin","technician"].includes(f(t).userRole)},[(a(!0),c(G,null,R(r.value,m=>(a(),c("option",{key:m.id,value:m.id},g(m.name),9,Ae))),128))],44,Be),[[J,n.value]])]),e("button",{type:"submit",onClick:Q(T,["prevent"]),class:"inline-flex items-center py-2.5 px-4 text-xs font-medium text-center text-white bg-purple rounded-lg hoverBlue"}," Enviar comentário ")]),e("form",Ie,[e("div",Fe,[p(ne,{modelValue:u.value,"onUpdate:modelValue":d[1]||(d[1]=m=>u.value=m),attachedFiles:v.value,"onUpdate:attachedFiles":D},null,8,["modelValue","attachedFiles"])])])]))}},k=s=>(le("data-v-75522664"),s=s(),re(),s),Ne={class:"flex h-[84vh] sm:h-full w-full"},Pe={class:"flex flex-col p-2 xl:p-5 gap-4"},Ze={class:"flex flex-col gap-3"},Oe=k(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Criado por: ",-1)),qe={class:"border bg-white flex justify-between w-40 lg:w-full py-1 lg:py-2 lg:px-2.5 rounded-lg border-solid border-black border-opacity-20"},ze={class:"flex flex-col gap-3"},Ye=k(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Técnico ",-1)),We={class:"flex justify-between w-40 lg:w-full"},Je={class:"flex flex-col gap-3"},Ke=k(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Categoria ",-1)),Qe={class:"border bg-white flex justify-between w-40 lg:w-full py-1 lg:py-2 lg:px-2.5 rounded-lg border-solid border-black border-opacity-20"},Xe={class:"flex flex-col gap-3"},et=k(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Urgência ",-1)),tt={class:"border bg-white flex justify-between w-40 lg:w-full py-1 lg:py-2 lg:px-2.5 rounded-lg border-solid border-black border-opacity-20"},st={class:"flex flex-col gap-3"},ot=k(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Estado ",-1)),at={class:"flex justify-between w-40 lg:w-full"},ct=k(()=>e("img",{class:"self-center",src:O},null,-1)),lt=k(()=>e("img",{class:"self-center",src:me},null,-1)),rt={class:"flex flex-col w-full lg:w-[80%]"},it={class:"justify-center flex flex-col py-2 px-5 h-[12vh] sm:h-[9vh] border-b-black border-b border-solid"},nt={class:"justify-between flex flex-col sm:flex-row gap-2 xl:gap-5"},dt={class:"text-purple text-2xl"},mt={class:"flex justify-end"},ut=["src"],pt={key:1},ht={key:0},gt={__name:"TicketDetailsPage",setup(s){const _=I(),b=te(),t=w({}),n=w([]),r=Z(),u=w([]),v=w([]);se((o,h,C)=>{S(o.params.ticketId).then(()=>C()).catch(P=>{console.error("Error fetching ticket details:",P),C(!1)})}),A(async()=>{await S(),await D(),await M(),await _.fetchAuthedUser()});const i=oe({showComments:!1}),D=async()=>{try{const o=await Y.getTechnicians();o.success?n.value=o.data:console.error("Invalid response structure:",o)}catch(o){console.error("Error fetching technicians:",o)}},S=async()=>{try{t.value=(await E.getTicket(b.params.ticketId)).data}catch(o){console.error("Error fetching tickets:",o)}},M=async()=>{try{const o=(await E.getStatuses()).data;u.value=o.filter(h=>h.name!=="Completo")}catch(o){console.error("Error fetching statuses:",o)}},T=async()=>{try{v.value=(await U.getComments(t.value.id)).data.comments}catch(o){console.error("Error fetching comments:",o)}};ae(()=>i.showComments,async()=>{i.showComments&&(console.log("fetching comments"),await T())});const l=(o,h)=>{r.handleShowModalStatus(o,t.value.id,h)},d=(o,h)=>{r.handleShowModalTech(o,t.value.id,h)},m=()=>{r.handleCancelModal()},F=()=>{r.handleConfirmModal()},L=async()=>{await r.closeTicket(t.value.id)},N=async()=>{await r.reopenTicket(t.value.id)};return(o,h)=>(a(),c("div",Ne,[p(q,{ticket:t.value},{default:x(()=>[p(z,null,{default:x(()=>[y("Detalhes do Ticket")]),_:1}),e("div",Pe,[e("div",Ze,[Oe,e("div",qe,g(t.value.createdby?t.value.createdby.name:"N/A"),1)]),e("div",ze,[Ye,e("div",We,[p(H,{currentValue:t.value.assignedto,newValues:n.value,onShowModal:d},null,8,["currentValue","newValues"])])]),e("div",Je,[Ke,e("div",Qe,g(t.value.category?t.value.category.name:"N/A"),1)]),e("div",Xe,[et,e("div",tt,g(t.value.priority?t.value.priority.name:"N/A"),1)]),e("div",st,[ot,e("div",at,[p(H,{currentValue:t.value.status,newValues:u.value,onShowModal:l},null,8,["currentValue","newValues"])])]),f(_).userRole==="admin"&&t.value.status.name!=="Completo"?(a(),B(j,{key:0,onClick:L,class:"w-full py-1 mt-4"},{default:x(()=>[ct,y(" Fechar ticket ")]),_:1})):V("",!0),f(_).userRole==="admin"&&t.value.status.name==="Completo"?(a(),B(j,{key:1,onClick:N,class:"w-full py-1 mt-4"},{default:x(()=>[lt,y(" Reabrir ticket ")]),_:1})):V("",!0)])]),_:1},8,["ticket"]),e("div",rt,[e("div",it,[e("span",nt,[e("div",dt,g(t.value.title?t.value.title:"N/A"),1),e("div",mt,[p(j,{onClick:h[0]||(h[0]=C=>i.showComments=!i.showComments)},{default:x(()=>[y(g(i.showComments?"Descrição":"Comentários")+" ",1),e("img",{src:i.showComments?f(Me):f(De)},null,8,ut)]),_:1})])])]),e("div",{class:ce(["text-purple sm:text-2xl text-xl overflow-auto justify-between pl-6 pr-12 py-4 items-start",{"h-[80vh]":!i.showComments,"h-[53vh] border-b-purple border-b-opacity-30 border-b border-solid":i.showComments}])},[i.showComments?(a(!0),c(G,{key:0},R(v.value,C=>(a(),c("div",{key:C.id},[p(Re,{comment:C},null,8,["comment"])]))),128)):(a(),c("div",pt,[p(xe,{myTicket:t.value},null,8,["myTicket"])]))],2),i.showComments?(a(),c("div",ht,[p(Le,{ticket:t.value,onRefreshComments:T},null,8,["ticket"])])):V("",!0)]),p(ie,{show:f(r).showModal,onCancel:m,onConfirm:F},{title:x(()=>[y(" Assign Technician ")]),content:x(()=>[y(" You are about to assign "+g(f(r).selectedTechnician)+" to this ticket, are you sure? ",1)]),_:1},8,["show"])]))}},Ct=ee(gt,[["__scopeId","data-v-75522664"]]);export{Ct as default};
