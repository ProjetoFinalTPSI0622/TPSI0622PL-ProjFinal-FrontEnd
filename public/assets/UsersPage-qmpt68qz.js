import{e as p,f as v,g as e,l as y,k as w,m as b,u as S,R as j,F as U,r as x,t as _,w as T,a3 as L,_ as N,i as I,j as A,C as B,D as z,E as O,p as k,o as R,q as V,v as F,B as q,z as G}from"./index-M00oQ38T.js";import{U as C}from"./UserService-NliMIl5m.js";import{S as H}from"./SimpleButton-0fOr69Ah.js";import{_ as K}from"./Modal-SvNs-sG_.js";import{u as E}from"./ToastStore-iXxZH6yu.js";const J={class:"border bg-white flex justify-between w-40 lg:w-60 py-1 lg:py-0 lg:px-2.5 rounded-xl border-solid border-black border-opacity-20"},Q=e("img",{loading:"lazy",src:"https://cdn.builder.io/api/v1/image/assets/TEMP/d8924cf9b87a9ac8c714bc39eb9f2f1e4dbacd969a523930ca05221671cf2023?apiKey=a9b902b8934746c7aacbbad131e88c89&",class:"aspect-[1.5] object-contain object-center"},null,-1),W=["value"],X={__name:"UsersSearchBox",props:{searchTerm:String},setup(s){return(r,l)=>(p(),v("span",J,[Q,e("input",{type:"text",class:"bg-transparent text-gray-900 focus:outline-none focus-visible:outline-none rounded-lg w-full lg:p-2.5",placeholder:"Procurar... ",value:s.searchTerm,onInput:l[0]||(l[0]=o=>r.$emit("update:searchTerm",o.target.value))},null,40,W)]))}},Y={class:"text-purple flex sm:text-2xl text-xl whitespace-nowrap justify-between p-4 border-b-purple border-b-opacity-30 border-b border-solid items-start"},Z=e("div",null,"Todos os Users",-1),ee={class:"flex flex-row justify-end p-3 border-b-black border-b-opacity-30 border-b border-solid items-start"},se={class:""},te={__name:"TopMenu",props:{searchTerm:String},emits:["update:searchTerm"],setup(s,{emit:r}){const l=s,o=r;return(t,a)=>(p(),v(U,null,[e("span",Y,[Z,y(S(j),{to:"/users/create"},{default:w(()=>[y(H,null,{default:w(()=>[b(" + Novo User")]),_:1})]),_:1})]),e("div",ee,[e("div",se,[y(X,{searchTerm:l.searchTerm,"onUpdate:searchTerm":a[0]||(a[0]=f=>o("update:searchTerm",f))},null,8,["searchTerm"])])])],64))}},oe={class:"hoverGrey border-b-black border-b-opacity-30 border-b border-solid grid grid-cols-3 sm:grid-cols-4 gap-4 pl-[10%] pr-[5%] sm:pl-[20%] sm:pr-[15%]"},ae={class:"flex flex-col gap-1 py-2 overflow-hidden overflow-ellipsis"},re=["src"],le={class:"flex w-full"},ne={class:"whitespace-nowrap text-black text-opacity-80 text-xs sm:text-lg text-left sm:w-full overflow-hidden overflow-ellipsis"},ce={class:"hidden sm:block whitespace-nowrap text-xs sm:text-lg self-center overflow-hidden overflow-ellipsis"},ie={class:"hidden sm:block whitespace-nowrap text-xs sm:text-lg self-center overflow-hidden overflow-ellipsis"},de={class:"whitespace-nowrap py-2.5 sm-py-0 self-center"},ue={class:"flex"},pe={class:"font-bold"},me=e("br",null,null,-1),ve=e("p",{class:"font-bold text-red-600"},"ATENÇÃO!!!",-1),fe=e("p",{class:"text-red-600"},"Esta acção não pode ser revertida!",-1),he={__name:"UserItem",props:{user:Object},emits:["userDeleted"],setup(s,{emit:r}){const l=r,o=x(!1),t=x(null),a=x(null),f=d=>{t.value=d,o.value=!0},m=async()=>{if(event.stopPropagation(),a.value==="delete"){if(t.value){const d=await C.deleteUser(t.value.id);d.success?(E().triggerToast(`Utilizador ${t.value.name}, apagado com sucesso!`,"success"),l("userDeleted")):console.error("Error deleting user:",d.message)}}else if(a.value==="reset"&&t.value){const d=await C.resetPassword(t.value);d.success?E().triggerToast(`Password de ${t.value.name}, alterada com sucesso!`,"success"):console.error("Error reseting password:",d.message)}o.value=!1},$=()=>{o.value=!1,event.stopPropagation()};return(d,n)=>(p(),v("tr",oe,[e("td",ae,[e("img",{loading:"lazy",src:s.user.user_info.profile_picture_path,class:"aspect-square object-cover content-start w-12 overflow-hidden shrink-0 max-w-full rounded-[50%]"},null,8,re),e("div",le,[e("div",ne,_(s.user.name),1)])]),e("td",ce,_(s.user.user_info.class),1),e("td",ie,_(s.user.internalcode),1),e("td",de,[e("button",{onClick:n[0]||(n[0]=T(c=>f(s.user,a.value="delete"),["stop"])),class:"p-2 mr-2 bg-red-500 text-white rounded hover:bg-red-700 transition duration-300 text-xs sm:text-lg"}," Apagar "),e("button",{onClick:n[1]||(n[1]=T(c=>f(s.user,a.value="reset"),["stop"])),class:"p-2 bg-yellow-600 text-white rounded hover:bg-red-700 transition duration-300 text-xs sm:text-lg"}," Repor password ")]),y(K,{show:o.value,onCancel:$,onConfirm:m},L({_:2},[a.value==="delete"?{name:"title",fn:w(()=>[b(" Apagar utilizador ")]),key:"0"}:a.value==="reset"?{name:"title",fn:w(()=>[b(" Repor password ")]),key:"1"}:void 0,a.value==="delete"?{name:"content",fn:w(()=>[e("p",ue,[b("Esta prestes a apagar  "),e("div",pe,_(s.user.name),1),b(", pretende prosseguir?")]),me,ve,fe]),key:"2"}:a.value==="reset"?{name:"content",fn:w(()=>[e("p",{class:"flex"},[b("A password de  "),e("div",{class:"font-bold"},_(s.user.name),1),b(", ficara o NIF dele, pretende prosseguir?")]),e("br"),e("p",{class:"font-bold text-red-600"},"ATENÇÃO!!!"),e("p",{class:"text-red-600"},"Esta acção não pode ser revertida!")]),key:"3"}:void 0]),1032,["show"])]))}},be=s=>(z("data-v-87cec33b"),s=s(),O(),s),_e={class:"table-auto"},xe=be(()=>e("thead",null,[e("tr",{class:"grid grid-cols-3 sm:grid-cols-4 pl-[10%] pr-[5%] sm:pl-[20%] sm:pr-[15%] border-b-black border-b-opacity-30 border-b border-solid"},[e("th",{class:"w-1/4 self-center"},"NOME"),e("th",{class:"hidden sm:block w-1/4 self-center"},"TURMA"),e("th",{class:"hidden lg:block w-1/4 self-center"},"CÓDIGO INTERNO")])],-1)),ge={class:"max-h-[57vh] sm:max-h-[58vh] overflow-y-auto"},we={__name:"UsersTable",props:{users:Array},emits:["userDeleted"],setup(s,{emit:r}){const l=r,o=a=>{B.push({name:"userDetails",params:{userId:a}})},t=()=>{l("userDeleted")};return(a,f)=>(p(),v("table",_e,[xe,e("div",ge,[e("tbody",null,[(p(!0),v(U,null,I(s.users,m=>(p(),A(he,{onClick:T($=>o(m.id),["stop"]),key:m.id,user:m,onUserDeleted:t},null,8,["onClick","user"]))),128))])])]))}},ye=N(we,[["__scopeId","data-v-87cec33b"]]),$e={class:"flex w-full"},ke={class:"flex flex-col w-full"},Te={class:"flex justify-between px-5 py-2 border-b-black border-b-opacity-30 border-b border-solid"},Ce={class:"text-black text-opacity-60 sm:text-xl"},Ue={class:"flex gap-1 sm:gap-2.5"},Me=e("option",{value:"5"},"5 por pagina",-1),Pe=e("option",{value:"10"},"10 por pagina",-1),De=e("option",{value:"20"},"20 por pagina",-1),Ee=["value"],Ie=["onClick"],Be={__name:"UsersPage",setup(s){const r=x([]),l=x(1),o=x(5),t=x(""),a=k(()=>{let n=[];const c=$.value,i=l.value;let u=Math.max(i-2,1),h=u+2;h>c&&(h=c,u=Math.max(1,h-2));for(let g=u;g<=h;g++)n.push(g);return n}),f=k(()=>{const n=r.value.filter(u=>{var h,g,M,P,D;return((h=u.name)==null?void 0:h.toLowerCase().includes(t.value.toLowerCase()))||((g=u.email)==null?void 0:g.toLowerCase().includes(t.value.toLowerCase()))||((M=u.internalcode)==null?void 0:M.toLowerCase().includes(t.value.toLowerCase()))||((D=(P=u.user_info)==null?void 0:P.class)==null?void 0:D.toLowerCase().includes(t.value.toLowerCase()))}),c=(l.value-1)*o.value,i=c+o.value;return n.slice(c,i)}),m=async()=>{try{r.value=(await C.getUsers()).data}catch(n){console.error("Erro ao procurar usuários:",n)}};R(async()=>{await m(),o.value=r.value.length});const $=k(()=>Math.ceil(r.value.length/o.value)),d=n=>{l.value=Math.max(1,Math.min(n,$.value))};return V(t,()=>{l.value=1}),(n,c)=>(p(),v("div",$e,[e("span",ke,[y(te,{searchTerm:t.value,"onUpdate:searchTerm":c[0]||(c[0]=i=>t.value=i)},null,8,["searchTerm"]),e("span",Te,[e("div",Ce,_(r.value.length)+" Users",1),e("div",Ue,[F(e("select",{"onUpdate:modelValue":c[1]||(c[1]=i=>o.value=i),onChange:c[2]||(c[2]=i=>d(1))},[Me,Pe,De,e("option",{value:r.value.length},"All",8,Ee)],544),[[q,o.value]]),(p(!0),v(U,null,I(a.value,i=>(p(),v("span",{class:G(["text-black sm:text-xl justify-center px-1.5 py-0.5 rounded-md self-start cursor-pointer",{"bg-purple text-white":i===l.value,"aspect-[0.8148148148148148]":!0}]),key:i,onClick:u=>d(i)},_(i),11,Ie))),128))])]),y(ye,{users:f.value,onUserDeleted:m},null,8,["users"])])]))}};export{Be as default};
