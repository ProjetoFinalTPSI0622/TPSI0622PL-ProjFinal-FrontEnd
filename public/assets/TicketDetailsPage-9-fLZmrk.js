import{e as r,f as n,g as e,F as j,i as E,h as $,A as V,m as C,t as w,u as b,r as p,o as A,v as z,B as re,y as ce,w as ne,l as d,G as le,_ as N,H as ie,a as I,I as de,b as me,q as ue,j as L,z as F,J as pe,k,D as he,E as fe}from"./index-OHFFj_LP.js";import{_ as ge}from"./remove-2QpsD6we.js";import{_ as we,S as _e}from"./SideSectionTop-9ioVQ8dn.js";import{T as U}from"./TicketsService-WNdmB0xw.js";import{U as ve}from"./UserService-EP3R9ON8.js";import{S as D}from"./SimpleButton-E3fC1VLg.js";import{u as xe}from"./ToastStore-saIhIEjP.js";import{_ as ye}from"./Modal-TFsZK21Z.js";import{u as ke,_ as G}from"./TicketStore-HD0zWsnh.js";import{_ as Ce,a as be}from"./TiptapEditor-vKZ4O5d9.js";import{u as q}from"./UserStore-5iqra5tF.js";import{L as Ve}from"./LocationsService-CUVwmqvZ.js";const Se="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20fill='%23ffffff'%20height='20px'%20width='20px'%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%20512%20512'%20enable-background='new%200%200%20512%20512'%20xml:space='preserve'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20d='M389.6,289.4c0,73.8-59.8,133.6-133.6,133.6c-73.7,0-133.6-59.8-133.6-133.6c0-73.8,59.8-133.6,133.6-133.6v66.8%20l113.9-111.3L256,0v66.8c-122.9,0-222.6,99.7-222.6,222.6C33.4,412.3,133.1,512,256,512c122.9,0,222.6-99.7,222.6-222.6H389.6z'/%3e%3c/g%3e%3c/svg%3e",Te="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='24'%20height='24'%20viewBox='0%200%20512%20512'%20xmlns='http://www.w3.org/2000/svg'%20fill='%23000000'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20fill='var(--ci-primary-color,%20%23000000)'%20d='M334.627,16H48V496H472V153.373ZM440,166.627V168H320V48h1.373ZM80,464V48H288V200H440V464Z'%20class='ci-primary'/%3e%3crect%20width='224'%20height='32'%20x='136'%20y='296'%20fill='var(--ci-primary-color,%20%23000000)'%20class='ci-primary'/%3e%3crect%20width='224'%20height='32'%20x='136'%20y='376'%20fill='var(--ci-primary-color,%20%23000000)'%20class='ci-primary'/%3e%3c/g%3e%3c/svg%3e",$e={class:"flex gap-4"},Me={class:"flex flex-col text-lg gap-4 text-wrap"},je=e("div",{class:"flex gap-1"},[e("img",{src:Te}),e("p",{class:"text-2xl"}," Ticket Description ")],-1),Re={class:"prose max-w-none"},De=["innerHTML"],Ge={key:0,class:"mt-4"},Ee=["src","alt"],He={__name:"DescriptionView",props:{myTicket:Object},setup(o){return(_,m)=>(r(),n("div",$e,[e("div",Me,[je,e("div",Re,[e("p",{class:"text-black text-opacity-70",innerHTML:o.myTicket.description},null,8,De),o.myTicket.attachments&&o.myTicket.attachments.length?(r(),n("div",Ge,[(r(!0),n(j,null,E(o.myTicket.attachments,(v,s)=>(r(),n("span",{key:s,class:"ml-2 inline-block"},[e("img",{src:v.FilePath,class:"max-w-lg rounded-lg",alt:"Attachment "+(s+1)},null,8,Ee)]))),128))])):$("",!0)])])]))}},Le="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Generator:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10%2012V17'%20stroke='%23000000'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M14%2012V17'%20stroke='%23000000'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M4%207H20'%20stroke='%23000000'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M6%2010V18C6%2019.6569%207.34315%2021%209%2021H15C16.6569%2021%2018%2019.6569%2018%2018V10'%20stroke='%23000000'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M9%205C9%203.89543%209.89543%203%2011%203H13C14.1046%203%2015%203.89543%2015%205V7H9V5Z'%20stroke='%23000000'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Ue={getComments:async o=>V.makeRequest("get",`tickets/${o}/comments`),createComment:async o=>V.makeRequest("post","comments",o,"multipart/form-data"),deleteComment:async o=>V.makeRequest("delete",`comments/${o}`),getCommentTypes:async()=>V.makeRequest("get","commentTypes")},Be={class:"pb-5 flex gap-4 max-w-[600px] text-wrap"},Pe=["src"],Ie={class:"text-lg flex flex-col gap-2 text-wrap"},Fe={class:"text-xl"},Ae={class:"text-sm text-gray-600"},ze={class:"text-black text-wrap gap-3 bg-stone-200 rounded-lg p-3 text-opacity-65 flex flex-row justify-between"},Ne=["innerHTML"],qe={key:0,class:"mt-4"},Ze=["src","alt"],Oe={class:"w-[10%] h-full flex justify-center"},We=e("img",{src:Le},null,-1),Ye=[We],Je={__name:"CommentsView",props:{comment:Object},emits:["refreshComments"],setup(o,{emit:_}){const m=_,v=o,s=new Date(v.comment.created_at),x=async g=>{await Ue.deleteComment(g),xe().triggerToast("Comentario Eliminado!","success"),m("refreshComments")};return(g,c)=>(r(),n("div",Be,[e("img",{loading:"lazy",src:o.comment.user.user_info.profile_picture_path,class:"aspect-square object-cover object-center w-10 h-10 overflow-hidden shrink-0 rounded-[50%]"},null,8,Pe),e("div",Ie,[e("p",Fe,[C(w(o.comment.user.name)+" - ",1),e("span",Ae,w(b(s).toLocaleString()),1)]),e("p",ze,[e("div",{class:"prose max-w-none",innerHTML:o.comment.comment_body},null,8,Ne),o.comment.attachments&&o.comment.attachments.length?(r(),n("div",qe,[(r(!0),n(j,null,E(o.comment.attachments,(T,y)=>(r(),n("span",{key:y,class:"ml-2 inline-block"},[e("img",{src:T.FilePath,class:"max-w-xs rounded-lg",alt:"Attachment "+(y+1)},null,8,Ze)]))),128))])):$("",!0),e("div",Oe,[e("button",{onClick:c[0]||(c[0]=T=>x(o.comment.id))},Ye)])])])]))}},Qe="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20fill='%23ffffff'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20xmlns='http://www.w3.org/2000/svg'%20stroke='none'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20d='M3,4V16a1,1,0,0,0,1,1H9l3,4,3-4h5a1,1,0,0,0,1-1V4a1,1,0,0,0-1-1H4A1,1,0,0,0,3,4ZM8,7h8a1,1,0,0,1,0,2H8A1,1,0,0,1,8,7Zm0,5h4a1,1,0,0,1,0,2H8a1,1,0,0,1,0-2Z'/%3e%3c/g%3e%3c/svg%3e",Ke="data:image/svg+xml,%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3c!--%20Uploaded%20to:%20SVG%20Repo,%20www.svgrepo.com,%20Transformed%20by:%20SVG%20Repo%20Mixer%20Tools%20--%3e%3csvg%20width='24'%20height='24'%20viewBox='0%200%20512%20512'%20xmlns='http://www.w3.org/2000/svg'%20fill='%23fff'%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20fill='var(--ci-primary-color,%20%23fff)'%20d='M334.627,16H48V496H472V153.373ZM440,166.627V168H320V48h1.373ZM80,464V48H288V200H440V464Z'%20class='ci-primary'/%3e%3crect%20width='224'%20height='32'%20x='136'%20y='296'%20fill='var(--ci-primary-color,%20%23fff)'%20class='ci-primary'/%3e%3crect%20width='224'%20height='32'%20x='136'%20y='376'%20fill='var(--ci-primary-color,%20%23fff)'%20class='ci-primary'/%3e%3c/g%3e%3c/svg%3e",B={getComments:async o=>V.makeRequest("get",`tickets/${o}/comments`),createComment:async o=>V.makeRequest("post","comments",o,"multipart/form-data"),deleteComment:async o=>V.makeRequest("delete",`comments/${o}`),getCommentTypes:async()=>V.makeRequest("get","commentTypes")},Xe={class:"text-purple flex w-full flex-col p-3 gap-3 sm:text-2xl text-xl items-start"},et={class:"flex justify-between text-xl gap-2 w-full"},tt={class:"flex"},st=e("img",{src:be},null,-1),ot=["disabled"],at=["value"],rt={class:"w-full border border-solid border-black border-opacity-20 rounded-lg bg-grey"},ct={class:"px-4 py-2 bg-grey rounded-t-lg"},nt={__name:"CreateCommentForm",props:{ticket:Object},emits:["refreshComments"],setup(o,{emit:_}){const m=_,v=q(),s=p(1),x=p(null),g=p(""),c=p([]),T=o,y=a=>{c.value=a};A(async()=>{await M()});const M=async()=>{try{x.value=(await B.getCommentTypes()).data}catch(a){console.error("Error fetching comment types:",a)}},u=a=>{s.value=a.target.value},R=async()=>{const a=new FormData;a.append("comment_body",g.value),a.append("comment_type",s.value),a.append("ticket_id",T.ticket.id),c.value.forEach((h,f)=>{a.append(`files[${f}]`,h.file)});try{const h=await B.createComment(a)}catch(h){console.error("Error posting comment:",h)}await le(async()=>{m("refreshComments"),g.value="",c.value=[]})};return(a,h)=>(r(),n("div",Xe,[e("div",et,[e("div",tt,[st,z(e("select",{style:ce({appearance:["admin","technician"].includes(b(v).userRole)?"auto":"none"}),class:"flex px-2","onUpdate:modelValue":h[0]||(h[0]=f=>s.value=f),onChange:u,disabled:!["admin","technician"].includes(b(v).userRole)},[(r(!0),n(j,null,E(x.value,f=>(r(),n("option",{key:f.id,value:f.id},w(f.name),9,at))),128))],44,ot),[[re,s.value]])]),e("button",{type:"submit",onClick:ne(R,["prevent"]),class:"inline-flex items-center py-2.5 px-4 text-xs font-medium text-center text-white bg-purple rounded-lg hoverBlue"}," Enviar comentário ")]),e("form",rt,[e("div",ct,[d(Ce,{modelValue:g.value,"onUpdate:modelValue":h[1]||(h[1]=f=>g.value=f),attachedFiles:c.value,"onUpdate:attachedFiles":y},null,8,["modelValue","attachedFiles"])])])]))}},lt={},it={class:"flex h-full w-full justify-center items-center"},dt=e("div",{class:"flex h-20 w-20 animate-spin rounded-full border-8 border-solid border-current border-r-transparent motion-reduce:animate-[spin_1.5s_linear_infinite]"},null,-1),mt=[dt];function ut(o,_){return r(),n("div",it,mt)}const pt=N(lt,[["render",ut]]),S=o=>(he("data-v-764c4fae"),o=o(),fe(),o),ht={key:1,class:"flex h-[84vh] sm:h-full w-full"},ft={class:"flex flex-col py-2 px-16 lg:p-5 gap-4 overflow-auto no-scrollbar"},gt={class:"flex flex-col gap-3"},wt=S(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Criado por: ",-1)),_t={class:"border bg-white flex justify-between lg:w-full py-1 lg:py-2 lg:px-2.5 rounded-lg border-solid border-black border-opacity-20"},vt={class:"flex flex-col gap-3"},xt=S(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Técnico ",-1)),yt={class:"flex justify-between lg:w-full"},kt={class:"flex flex-col gap-3"},Ct=S(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Categoria ",-1)),bt={class:"border bg-white flex justify-between lg:w-full py-1 lg:py-2 lg:px-2.5 rounded-lg border-solid border-black border-opacity-20"},Vt={class:"flex flex-col gap-3"},St=S(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Urgência ",-1)),Tt={class:"flex justify-between lg:w-full"},$t={class:"flex flex-col gap-3"},Mt=S(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Estado ",-1)),jt={class:"flex justify-between lg:w-full"},Rt={class:"flex flex-col gap-3"},Dt=S(()=>e("label",{class:"text-pink-600 text-l xl:text-lg justify-center"}," Localização ",-1)),Gt={class:"flex justify-between lg:w-full"},Et=S(()=>e("img",{class:"self-center",src:ge},null,-1)),Ht=S(()=>e("img",{class:"self-center",src:Se},null,-1)),Lt={class:"flex flex-col w-full lg:w-[80%]"},Ut={class:"justify-center flex flex-col py-8 px-5 h-[20vh] sm:h-[9vh] border-b-black border-b border-solid"},Bt={class:"justify-between flex flex-col sm:flex-row gap-2 xl:gap-5"},Pt={class:"text-purple text-xl lg:text-2xl"},It={class:"flex justify-end"},Ft=["src"],At={key:1},zt={key:0},Nt={__name:"TicketDetailsPage",setup(o){const _=q(),m=p(!1),v=ie(),s=p({}),x=p(!0),g=p([]),c=ke(),T=p([]),y=p([]),M=p([]),u=I({title:"",content:""}),R=p([]);de((t,l,i)=>{P(t.params.ticketId).then(()=>i()).catch(ae=>{console.error("Error fetching ticket details:",ae),i(!1)})}),A(async()=>{await P(),await Z(),await O(),await f(),await h(),x.value=!1}),me(()=>{const t=window.matchMedia("(min-width: 1024px)");m.value=t.matches,t.addEventListener("change",l=>{m.value=l.matches})});const a=I({showComments:!1}),h=async()=>{try{const t=await Ve.getLocations();t.success?(M.value=t.data,console.log(M.value)):console.error("Invalid response structure:",t)}catch(t){console.error("Error fetching priorities:",t)}},f=async()=>{try{const t=await U.getPriorities();t.success?(y.value=t.data,console.log(y.value)):console.error("Invalid response structure:",t)}catch(t){console.error("Error fetching priorities:",t)}},Z=async()=>{try{const t=await ve.getTechnicians();t.success?g.value=t.data:console.error("Invalid response structure:",t)}catch(t){console.error("Error fetching technicians:",t)}},P=async()=>{try{s.value=(await U.getTicket(v.params.ticketId)).data}catch(t){console.error("Error fetching tickets:",t)}},O=async()=>{try{const t=(await U.getStatuses()).data;T.value=t.filter(l=>l.name!=="Completo")}catch(t){console.error("Error fetching statuses:",t)}},H=async()=>{try{R.value=(await B.getComments(s.value.id)).data.comments}catch(t){console.error("Error fetching comments:",t)}};ue(()=>a.showComments,async()=>{a.showComments&&(console.log("fetching comments"),await H())});const W=(t,l,i)=>{u.title="Mudar Estado",u.content="Está prestes a mudar o estado deste ticket. Deseja continuar?",c.handleShowModalStatus(t,s.value.id,l,i)},Y=(t,l,i)=>{u.title="Atribuir técnico",u.content="Está prestes a atribuir um técnico a este ticket. Deseja continuar?",c.handleShowModalTech(t,s.value.id,l,i)},J=(t,l,i)=>{u.title="Mudar Urgência",u.content="Está prestes a mudar a urgência deste ticket. Deseja continuar?",c.handleShowModalPriority(t,s.value.id,l,i)},Q=(t,l,i)=>{u.title="Mudar Localização",u.content="Está prestes a mudar a localização deste ticket. Deseja continuar?",c.handleShowModalLocation(t,s.value.id,l,i)},K=()=>{c.handleCancelModal()},X=()=>{c.handleConfirmModal()},ee=async()=>{await c.closeTicket(s.value.id)},te=async()=>{await c.reopenTicket(s.value.id)},se=()=>{m.value=!m.value},oe=()=>{c.convertSingleTicketToPDF(s.value)};return(t,l)=>(r(),n(j,null,[x.value?(r(),L(pt,{key:0})):$("",!0),x.value?$("",!0):(r(),n("div",ht,[e("button",{class:F(["fixed top-[50%] z-50 sm:hidden bg-purple text-white px-1",m.value?"right-0 rounded-l-lg":"left-0 rounded-r-lg"]),onClick:se},w(m.value?"<<":">>"),3),z(d(we,{ticket:s.value,class:"fixed inset-0 z-40 lg:static lg:z-auto"},{default:k(()=>[d(_e,null,{default:k(()=>[C("Detalhes do Ticket")]),_:1}),e("div",ft,[e("div",gt,[wt,e("div",_t,w(s.value.createdby?s.value.createdby.name:"N/A"),1)]),e("div",vt,[xt,e("div",yt,[d(G,{currentValue:s.value.assignedto,newValues:g.value,onShowModal:Y},null,8,["currentValue","newValues"])])]),e("div",kt,[Ct,e("div",bt,w(s.value.category?s.value.category.name:"N/A"),1)]),e("div",Vt,[St,e("div",Tt,[d(G,{currentValue:s.value.priority,newValues:y.value,onShowModal:J},null,8,["currentValue","newValues"])])]),e("div",$t,[Mt,e("div",jt,[d(G,{currentValue:s.value.status,newValues:T.value,onShowModal:W},null,8,["currentValue","newValues"])])]),e("div",Rt,[Dt,e("div",Gt,[d(G,{currentValue:s.value.location,newValues:M.value,onShowModal:Q},null,8,["currentValue","newValues"])])]),(b(_).userRole==="admin"||b(_).userRole==="technician")&&s.value.status.name!=="Completo"?(r(),L(D,{key:0,onClick:ee,class:"w-full py-1"},{default:k(()=>[Et,C(" Fechar ticket ")]),_:1})):$("",!0),s.value.status.name==="Completo"?(r(),L(D,{key:1,onClick:te,class:"w-full py-1"},{default:k(()=>[Ht,C(" Reabrir ticket ")]),_:1})):$("",!0),d(D,{onClick:oe,class:"w-full py-1 mt-2"},{default:k(()=>[C("Exportar para pdf")]),_:1})])]),_:1},8,["ticket"]),[[pe,m.value]]),e("div",Lt,[e("div",Ut,[e("span",Bt,[e("div",Pt,w(s.value.title?s.value.title:"N/A"),1),e("div",It,[d(D,{onClick:l[0]||(l[0]=i=>a.showComments=!a.showComments)},{default:k(()=>[C(w(a.showComments?"Descrição":"Comentários")+" ",1),e("img",{src:a.showComments?b(Ke):b(Qe)},null,8,Ft)]),_:1})])])]),e("div",{class:F(["text-purple sm:text-2xl text-xl overflow-auto justify-between sm:pl-4 sm:pr-12 px-14 py-4 items-start",{"h-[80vh]":!a.showComments,"h-[53vh] border-b-purple border-b-opacity-30 border-b border-solid":a.showComments}])},[a.showComments?(r(!0),n(j,{key:0},E(R.value,i=>(r(),n("div",{key:i.id},[d(Je,{comment:i,onRefreshComments:H},null,8,["comment"])]))),128)):(r(),n("div",At,[d(He,{myTicket:s.value},null,8,["myTicket"])]))],2),a.showComments?(r(),n("div",zt,[d(nt,{ticket:s.value,onRefreshComments:H},null,8,["ticket"])])):$("",!0)]),d(ye,{show:b(c).showModal,onCancel:K,onConfirm:X},{title:k(()=>[C(w(u.title),1)]),content:k(()=>[C(w(u.content),1)]),_:1},8,["show"])]))],64))}},os=N(Nt,[["__scopeId","data-v-764c4fae"]]);export{os as default};
