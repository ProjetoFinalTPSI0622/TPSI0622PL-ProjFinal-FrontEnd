import{A as q,_ as f,a as M,F as R}from"./DataPicker-cS3EyL_t.js";import{F as j,I as u}from"./Input-OgLWhDcj.js";import{B as $}from"./ButtonSubmit-Cp79qUBk.js";import{U as r}from"./UserService-Rk__Pi1E.js";import{r as n,x as w,b as z,e as O,f as P,l as t,w as m,g as s,m as G,F as H,D as Z}from"./index-Gnznze0_.js";import{_ as J,u as K}from"./Modal-n158dQhz.js";const Q={class:"flex flex-col w-full my-5"},W={class:"flex flex-col gap-5 md:flex-row"},X={class:"flex flex-col gap-5 mt-5 md:flex-row"},Y={class:"flex flex-col gap-5 mt-5 md:flex-row"},ee={class:"flex flex-col gap-5 mt-5 md:flex-row"},le={class:"flex flex-col md:flex-row md:items-end gap-3 lg:w-2/4"},ae={class:"flex flex-col gap-5 mt-5 md:flex-row"},oe={class:"flex flex-col gap-5 mt-5 md:flex-row md:mt-5"},te=s("p",{class:"flex"},"Deseja prosseguir com a alteração dos dados?",-1),me={__name:"ShowUserForm",props:{myuser:Object},setup(S){const B=S,i=n(!1),c=n([]),_=n([]),y=n([]),p=n(null),d=n({id:"",name:"",email:"",internalcode:"",role:null}),a=n({user_id:"",avatar:"",class:"",nif:"",gender_id:"",phone_number:"",birthday_date:"",address:"",city:"",district:"",postal_code:"",country_id:""});w(()=>B.myuser,e=>{var l,o,x,b,g,T,C,L,h,F,U,A;if(e){let k=Array.isArray(e.roles)&&e.roles.length>0?e.roles[0]:{};d.value={id:e.id||"",name:e.name||"",email:e.email||"",internalcode:e.internalcode||"",role:k.id||""},a.value={user_id:((l=e.user_info)==null?void 0:l.user_id)||"",avatar:((o=e.user_info)==null?void 0:o.profile_picture_path)||"",class:((x=e.user_info)==null?void 0:x.class)||"",nif:(b=e.user_info)!=null&&b.nif?e.user_info.nif.toString():"",gender_id:(g=e.user_info)!=null&&g.gender_id?e.user_info.gender_id:"",phone_number:(T=e.user_info)!=null&&T.phone_number?e.user_info.phone_number.toString():"",birthday_date:((C=e.user_info)==null?void 0:C.birthday_date)||"",address:((L=e.user_info)==null?void 0:L.address)||"",city:((h=e.user_info)==null?void 0:h.city)||"",district:((F=e.user_info)==null?void 0:F.district)||"",postal_code:((U=e.user_info)==null?void 0:U.postal_code)||"",country_id:(A=e.user_info)!=null&&A.country_id?e.user_info.country_id:""}}},{deep:!0,immediate:!0}),z(async()=>{try{c.value=(await r.getRoles()).data,_.value=(await r.getGenders()).data,y.value=(await r.getCountries()).data}catch(e){console.error("Error:",e.response)}});const D=e=>{p.value=e,a.value.avatar=URL.createObjectURL(e)},v=e=>{const l=Object.keys(e)[0];a[l]=e[l]},V=()=>{i.value=!0},E=async()=>{N()},I=()=>{i.value=!1},N=async()=>{const e=new FormData;p.value&&e.append("file",p.value),e.append("user_id",a.value.user_id),e.append("name",d.value.name),e.append("class",a.value.class),e.append("nif",a.value.nif),e.append("birthday_date",a.value.birthday_date),e.append("gender_id",a.value.gender_id),e.append("phone_number",a.value.phone_number),e.append("address",a.value.address),e.append("postal_code",a.value.postal_code),e.append("city",a.value.city),e.append("district",a.value.district),e.append("country_id",a.value.country_id),e.append("_method","PUT");try{await r.updateUser(d.value),console.log("User updated successfully"),await r.updateUserInfo(e).then(l=>{l.success&&(window.dispatchEvent(new Event("user-updated")),i.value=!1,Z.push({name:"Users"}),K().triggerToast("Utilizador actualizado com sucesso!","success"))})}catch(l){console.error("Error: ",l.response)}};return(e,l)=>(O(),P(H,null,[t(R,{onFormSubmit:V},{AvatarCard:m(()=>[t(q,{onAvatar:D,modelValue:a.value.avatar,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.avatar=o)},null,8,["modelValue"])]),Form:m(()=>[t(j,{FormTitle:"Update User"}),s("div",Q,[s("div",W,[t(u,{LabelTitle:"Full Name: *",type:"name",required:"",modelValue:d.value.name,"onUpdate:modelValue":l[1]||(l[1]=o=>d.value.name=o)},null,8,["modelValue"]),t(u,{LabelTitle:"Email: *",type:"email",required:"",modelValue:d.value.email,"onUpdate:modelValue":l[2]||(l[2]=o=>d.value.email=o)},null,8,["modelValue"])]),s("div",X,[t(u,{LabelTitle:"Internal Code: *",type:"text",required:"",modelValue:d.value.internalcode,"onUpdate:modelValue":l[3]||(l[3]=o=>d.value.internalcode=o)},null,8,["modelValue"]),t(u,{LabelTitle:"Class:",type:"text",modelValue:a.value.class,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.class=o)},null,8,["modelValue"])]),s("div",Y,[t(f,{LabelTitle:"Role:",options:c.value,modelValue:d.value.role,"onUpdate:modelValue":[l[5]||(l[5]=o=>d.value.role=o),v]},null,8,["options","modelValue"]),t(f,{LabelTitle:"Gender:",options:_.value,modelValue:a.value.gender_id,"onUpdate:modelValue":[l[6]||(l[6]=o=>a.value.gender_id=o),v]},null,8,["options","modelValue"]),t(M,{LabelTitle:"Birthday Date: *",required:"",modelValue:a.value.birthday_date,"onUpdate:modelValue":l[7]||(l[7]=o=>a.value.birthday_date=o)},null,8,["modelValue"])]),s("div",ee,[s("div",le,[t(u,{LabelTitle:"NIF: *",type:"text",required:"",modelValue:a.value.nif,"onUpdate:modelValue":l[8]||(l[8]=o=>a.value.nif=o)},null,8,["modelValue"])]),t(u,{LabelTitle:"Phone Number:",type:"text",modelValue:a.value.phone_number,"onUpdate:modelValue":l[9]||(l[9]=o=>a.value.phone_number=o)},null,8,["modelValue"])]),s("div",ae,[t(u,{LabelTitle:"Address:",type:"address",modelValue:a.value.address,"onUpdate:modelValue":l[10]||(l[10]=o=>a.value.address=o)},null,8,["modelValue"]),t(u,{LabelTitle:"Zip Code:",type:"text",modelValue:a.value.postal_code,"onUpdate:modelValue":l[11]||(l[11]=o=>a.value.postal_code=o)},null,8,["modelValue"])]),s("div",oe,[t(u,{LabelTitle:"State/Province:",type:"text",modelValue:a.value.district,"onUpdate:modelValue":l[12]||(l[12]=o=>a.value.district=o)},null,8,["modelValue"]),t(u,{LabelTitle:"City:",type:"text",modelValue:a.value.city,"onUpdate:modelValue":l[13]||(l[13]=o=>a.value.city=o)},null,8,["modelValue"]),t(f,{LabelTitle:"Country:",options:y.value,modelValue:a.value.country_id,"onUpdate:modelValue":[l[14]||(l[14]=o=>a.value.country_id=o),v]},null,8,["options","modelValue"])])]),t($,{onClick:l[15]||(l[15]=o=>V(d.value)),textButton:"Update User"})]),_:1}),t(J,{show:i.value,onCancel:I,onConfirm:E},{title:m(()=>[G(" Alterar dados de utilizador ")]),content:m(()=>[te]),_:1},8,["show"])],64))}};export{me as _};
